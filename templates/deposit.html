<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deposit - Talk2Fill</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-content">
            <a href="/" class="logo">Talk2Fill</a>
            <div class="nav-links">
                <a href="/">Home</a>
                <a href="deposit.html">Deposit</a>
                <a href="withdraw.html">Withdraw</a>
                <a href="account-opening.html">Open Account</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="card">
            <div class="card-header">
                <h1 class="card-title" data-en="Deposit Money" data-te="డిపాజిట్ డబ్బు" data-hi="जमा धन">Deposit Money</h1>
                <div class="language-selector">
                    <label for="languageSelect" class="form-label" data-en="Select Language:" data-te="భాషను ఎంచుకోండి:" data-hi="भाषा चुनें:">Select Language:</label>
                    <select id="languageSelect" class="language-select">
                        <option value="en">English</option>
                        <option value="te">Telugu</option>
                        <option value="hi">Hindi</option>
                    </select>
                </div>
            </div>

            <!-- Messages -->
            <div id="errorMessage" class="message error-message"></div>
            <div id="successMessage" class="message success-message"></div>

            <!-- Deposit Form -->
            <form id="depositForm" class="deposit-form">
                <div class="form-group">
                    <label for="branchName" class="form-label" data-en="Branch Name" data-te="శాఖ పేరు" data-hi="शाखा का नाम">Branch Name</label>
                    <input type="text" id="branchName" name="branchName" class="form-control" required>
                    <small class="form-text" data-en="Example: SBI Hyderabad Main Branch" data-te="ఉదాహరణ: SBI హైదరాబాద్ మెయిన్ బ్రాంచ్" data-hi="उदाहरण: SBI हैदराबाद मुख्य शाखा">Example: SBI Hyderabad Main Branch</small>
                </div>

                <div class="form-group">
                    <label for="accountNumber" class="form-label" data-en="Account Number" data-te="ఖాతా సంఖ్య" data-hi="खाता संख्या">Account Number</label>
                    <input type="text" id="accountNumber" name="accountNumber" class="form-control" required
                           pattern="[0-9]{12}" title="Please enter a valid 12-digit account number">
                    <small class="form-text" data-en="Example: 123456789012" data-te="ఉదాహరణ: 123456789012" data-hi="उदाहरण: 123456789012">Example: 123456789012</small>
                </div>

                <div class="form-group">
                    <label for="accountHolderName" class="form-label" data-en="Account Holder's Name" data-te="ఖాతా యజమాని పేరు" data-hi="खाताधारक का नाम">Account Holder's Name</label>
                    <input type="text" id="accountHolderName" name="accountHolderName" class="form-control" required>
                    <small class="form-text" data-en="Example: Karthikeya Reddy" data-te="ఉదాహరణ: కార్తికేయ రెడ్డి" data-hi="उदाहरण: कार्तिकेय रेड्डी">Example: Karthikeya Reddy</small>
                </div>

                <div id="cashDetails" class="form-group">
                    <label class="form-label" data-en="Denomination Details" data-te="డినామినేషన్ వివరాలు" data-hi="मूल्यवर्ग विवरण">Denomination Details</label>
                    <div class="denomination-grid">
                        <div class="form-group">
                            <label for="d2000" class="form-label">₹2000 Notes</label>
                            <input type="number" id="d2000" name="d2000" class="form-control" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label for="d500" class="form-label">₹500 Notes</label>
                            <input type="number" id="d500" name="d500" class="form-control" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label for="d200" class="form-label">₹200 Notes</label>
                            <input type="number" id="d200" name="d200" class="form-control" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label for="d100" class="form-label">₹100 Notes</label>
                            <input type="number" id="d100" name="d100" class="form-control" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label for="d50" class="form-label">₹50 Notes</label>
                            <input type="number" id="d50" name="d50" class="form-control" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label for="d20" class="form-label">₹20 Notes</label>
                            <input type="number" id="d20" name="d20" class="form-control" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label for="d10" class="form-label">₹10 Notes</label>
                            <input type="number" id="d10" name="d10" class="form-control" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label for="d5" class="form-label">₹5 Coins</label>
                            <input type="number" id="d5" name="d5" class="form-control" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label for="d2" class="form-label">₹2 Coins</label>
                            <input type="number" id="d2" name="d2" class="form-control" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label for="d1" class="form-label">₹1 coins </label>
                            <input type="number" id="d1" name="d1" class="form-control" min="0" value="0">
                        </div>
                    </div>
                    <div class="total-amount">
                        <label class="form-label" data-en="Total Amount" data-te="మొత్తం మొత్తం" data-hi="कुल राशि">Total Amount</label>
                        <div id="totalAmount" class="amount-display">₹0</div>
                    </div>
                </div>


                <div class="form-group">
                    <label for="amount" class="form-label" data-en="Amount" data-te="మొత్తం" data-hi="राशि">Amount</label>
                    <input type="number" id="amount" name="amount" class="form-control" required min="1">
                    <small class="form-text" data-en="Example: 5000" data-te="ఉదాహరణ: 5000" data-hi="उदाहरण: 5000">Example: 5000</small>
                </div>

                <div class="form-group">
                    <label for="depositMode" class="form-label" data-en="Mode of Deposit" data-te="డిపాజిట్ మోడ్" data-hi="जमा का माध्यम">Mode of Deposit</label>
                    <select id="depositMode" name="depositMode" class="form-control" required>
                        <option value="cash" data-en="Cash" data-te="నగదు" data-hi="नकद">Cash</option>
                        <option value="cheque" data-en="Cheque" data-te="చెక్" data-hi="चेक">Cheque</option>
                    </select>
                </div>

                <!-- Denomination Details (for cash deposits) -->
                
                <!-- Cheque Details (for cheque deposits) -->
                <div id="chequeDetails" class="form-group" style="display: none;">
                    <div class="form-group">
                        <label for="chequeNumber" class="form-label" data-en="Cheque Number" data-te="చెక్ నంబర్" data-hi="चेक नंबर">Cheque Number</label>
                    <input type="text" id="chequeNumber" name="chequeNumber" class="form-control">
                    </div>
                    <div class="form-group">
                    <label for="chequeBankName" class="form-label" data-en="Bank Name" data-te="బ్యాంక్ పేరు" data-hi="बैंक का नाम">Bank Name</label>
                    <input type="text" id="chequeBankName" name="chequeBankName" class="form-control">
                </div>
                </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-primary" data-en="Submit Deposit" data-te="డిపాజిట్ సమర్పించండి" data-hi="जमा करें">Submit Deposit</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Floating Voice Input Button -->
    <button id="floatingVoiceBtn" class="floating-voice-btn" title="Voice Input">
        <i class="fas fa-microphone"></i>
    </button>
    <div id="floatingVoiceStatus" class="floating-voice-status"
         data-en="Recording... Speak now!"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
         data-hi="रिकॉर्डिंग... अब बोलिए!"  
         data-te="రికార్డింగ్... ఇప్పుడు మాట్లాడండి!">Click microphone to start recording</div>

    <!-- Confirmation Modal -->
    <div id="confirmationModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-icon">
                <div class="modal-timer">6</div>
            </div>
            <h2 class="modal-title">Are you sure?</h2>
            <p id="modalMessage" class="modal-message"></p>
            <div class="modal-buttons">
                <button id="modalCancel" class="modal-btn modal-btn-cancel">Cancel</button>
                <button id="modalConfirm" class="modal-btn modal-btn-confirm">Yes, confirm</button>
            </div>
        </div>
    </div>

    <script src="/static/js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

    <script>
        // Initialize jsPDF
        window.jsPDF = window.jspdf.jsPDF;

        // Helper functions
        function getFormValue(id) {
            const element = document.getElementById(id);
            return element ? element.value.trim() : '';
        }

        function cleanText(text) {
            if (!text || text.trim() === '') return '_________________';
            return text.trim();
        }

        // Translation API function
        async function translateText(text, sourceLang) {
            if (!text || text.trim() === '') return '_________________';
            
            try {
                // If text is already in English, return as is
                if (sourceLang === 'en') return text;

                // Use a free Google Translate proxy
                const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=${sourceLang}&tl=en&dt=t&q=${encodeURIComponent(text)}`;
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (data && data[0] && data[0][0] && data[0][0][0]) {
                    return data[0][0][0];
                }
                return text;
            } catch (error) {
                console.error('Translation error:', error);
                return text;
            }
        }

        // Update the generatePDF function
        async function generatePDF() {
            try {
                // Get the selected language
                const selectedLang = document.getElementById('languageSelect').value;
                
                // Get and translate form values
                const branchName = await translateText(getFormValue('branchName'), selectedLang);
                const accountHolderName = await translateText(getFormValue('accountHolderName'), selectedLang);
                const chequeBankName = await translateText(getFormValue('chequeBankName'), selectedLang);

                console.log('Translated values:', {
                    branchName,
                    accountHolderName,
                    chequeBankName
                });

                const formData = {
                    branchName: branchName || '_________________',
                    accountNumber: cleanText(getFormValue('accountNumber')),
                    accountHolderName: accountHolderName || '_________________',
                    amount: getFormValue('amount'),
                    depositMode: getFormValue('depositMode'),
                    chequeNumber: cleanText(getFormValue('chequeNumber')),
                    chequeBankName: chequeBankName || '_________________',
                    d2000: getFormValue('d2000') || '0',
                    d500: getFormValue('d500') || '0',
                    d200: getFormValue('d200') || '0',
                    d100: getFormValue('d100') || '0',
                    d50: getFormValue('d50') || '0',
                    d20: getFormValue('d20') || '0',
                    d10: getFormValue('d10') || '0',
                    d5: getFormValue('d5') || '0',
                    d2: getFormValue('d2') || '0',
                    d1: getFormValue('d1') || '0'
                };

                // Create PDF in landscape mode with larger width
                const doc = new jsPDF({
                    orientation: 'landscape',
                    unit: 'mm',
                    format: 'a4'
                });

                // Set default font
                doc.setFont('helvetica');
                let y = 20;

                // Add bank logo and header
                doc.setFontSize(18);
                doc.text('Bank Deposit Slip', 148.5, y, { align: 'center' });
                
                // Add timestamp and date with bold labels
                y += 15;
                doc.setFontSize(10);
                doc.setFont('helvetica', 'bold');
                doc.text('Date:', 20, y);
                doc.text('Time:', 120, y);
                doc.setFont('helvetica', 'normal');
                const now = new Date();
                doc.text(now.toLocaleDateString(), 35, y);
                doc.text(now.toLocaleTimeString(), 135, y);

                // Add branch info with bold label
                y += 10;
                doc.setFont('helvetica', 'bold');
                doc.text('Branch:', 20, y);
                doc.setFont('helvetica', 'normal');
                doc.text(formData.branchName || '_________________', 40, y);

                // Add account details with bold labels
                y += 10;
                doc.setFont('helvetica', 'bold');
                doc.text('Account Number:', 20, y);
                doc.setFont('helvetica', 'normal');
                doc.text(formData.accountNumber || '_________________', 60, y);

                y += 10;
                doc.setFont('helvetica', 'bold');
                doc.text('Account Holder:', 20, y);
                doc.setFont('helvetica', 'normal');
                doc.text(formData.accountHolderName || '_________________', 60, y);

                // First table - Details of Cash/Cheque
                y += 15;
                // Add grey background for headers
                doc.setFillColor(240, 240, 240);
                doc.rect(20, y, 180, 8, 'F');
                doc.rect(200, y, 70, 8, 'F');
                doc.rect(20, y, 180, 8);
                doc.rect(200, y, 70, 8);
                doc.setFont('helvetica', 'bold');
                doc.text('Details of Cash/Cheque', 25, y + 6);
                doc.text('Amount (Rs.)', 205, y + 6);

                // Amount row
                y += 8;
                doc.rect(20, y, 180, 8);
                doc.rect(200, y, 70, 8);
                doc.setFont('helvetica', 'normal');
                if (formData.depositMode === 'cash') {
                    doc.text('Cash Deposit', 25, y + 6);
                } else {
                    doc.text(`Cheque No: ${formData.chequeNumber || ''}`, 25, y + 6);
                }
                const amount = formData.amount;
                doc.text(amount ? `₹${Number(amount).toLocaleString('en-IN')}` : '', 205, y + 6);

                // Total in Words row with proper cell height for wrapping
                y += 8;
                const words = amount ? `Rupees ${numberToWords(Number(amount))} Only` : '';
                const lineHeight = 12;
                doc.rect(20, y, 180, lineHeight);
                doc.rect(200, y, 70, lineHeight);
                doc.setFont('helvetica', 'bold');
                doc.text('Total in Words:', 25, y + 6);
                doc.setFont('helvetica', 'normal');
                doc.text(words, 25, y + 11, { maxWidth: 170 });

                // Denomination table
                y += 20;
                // Headers with grey background
                doc.setFillColor(240, 240, 240);
                doc.rect(20, y, 50, 8, 'F');
                doc.rect(70, y, 40, 8, 'F');
                doc.rect(110, y, 40, 8, 'F');
                doc.rect(150, y, 40, 8, 'F');
                doc.rect(190, y, 30, 8, 'F');
                doc.rect(220, y, 50, 8, 'F');

                // Header borders
                doc.rect(20, y, 50, 8);
                doc.rect(70, y, 40, 8);
                doc.rect(110, y, 40, 8);
                doc.rect(150, y, 40, 8);
                doc.rect(190, y, 30, 8);
                doc.rect(220, y, 50, 8);

                // Header texts
                doc.setFont('helvetica', 'bold');
                doc.text('Drawn on Bank', 22, y + 6);
                doc.text('Branch', 72, y + 6);
                doc.text('Cheque No.', 112, y + 6);
                doc.text('Cash Notes', 152, y + 6);
                doc.text('Count', 192, y + 6);
                doc.text('Amount (Rs.)', 222, y + 6);

                // Denomination rows
                const denominations = [2000, 500, 200, 100, 50, 20, 10];
                let totalAmount = 0;

                denominations.forEach((denom) => {
                    y += 8;
                    const count = parseInt(formData[`d${denom}`]) || 0;
                    const denomAmount = count * denom;
                    totalAmount += denomAmount;

                    // Draw cells
                    doc.rect(20, y, 50, 8);
                    doc.rect(70, y, 40, 8);
                    doc.rect(110, y, 40, 8);
                    doc.rect(150, y, 40, 8);
                    doc.rect(190, y, 30, 8);
                    doc.rect(220, y, 50, 8);
                    
                    // Fill data
                    doc.setFont('helvetica', 'normal');
                    if (formData.depositMode === 'cheque') {
                        doc.text(formData.chequeBankName || '', 22, y + 6);
                        doc.text(formData.branchName || '', 72, y + 6);
                        doc.text(formData.chequeNumber || '', 112, y + 6);
                    }
                    doc.text(`x ${denom}`, 152, y + 6);
                    doc.text(count.toString(), 192, y + 6);
                    doc.text(denomAmount > 0 ? denomAmount.toLocaleString('en-IN') : '', 222, y + 6);
                });

                // Total row with grey background
                y += 8;
                doc.setFillColor(240, 240, 240);
                doc.rect(20, y, 200, 8, 'F');
                doc.rect(220, y, 50, 8, 'F');
                doc.rect(20, y, 200, 8);
                doc.rect(220, y, 50, 8);
                doc.setFont('helvetica', 'bold');
                doc.text('Total', 22, y + 6);
                doc.text(totalAmount.toLocaleString('en-IN'), 222, y + 6);

                // Signature section
                y += 20;
                doc.setFont('helvetica', 'normal');
                doc.text('Depositor\'s Signature: _______________________________', 20, y);
                doc.text('Teller\'s Signature: _______________________________', 180, y);

                // Save the PDF
                doc.save('deposit_slip.pdf');
            } catch (error) {
                console.error('Error generating PDF:', error);
                showError('Failed to generate PDF. Please try again. Error: ' + error.message);
            }
        }

        // Handle form submission
        document.getElementById('depositForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            generatePDF();
        });

        // Handle deposit mode change
        document.getElementById('depositMode').addEventListener('change', function() {
            const cashDetails = document.getElementById('cashDetails');
            const chequeDetails = document.getElementById('chequeDetails');
            
            if (this.value === 'cash') {
                cashDetails.style.display = 'block';
                chequeDetails.style.display = 'none';
            } else {
                cashDetails.style.display = 'none';
                chequeDetails.style.display = 'block';
            }
        });

        // Update form labels based on selected language
        document.getElementById('languageSelect').addEventListener('change', function() {
            const language = this.value;
            const labels = document.querySelectorAll('[data-en]');
            
            labels.forEach(label => {
                label.textContent = label.getAttribute(`data-${language}`);
            });
        });

        // Handle denomination calculations
        const denominationInputs = document.querySelectorAll('.denomination-grid input');
        const totalAmountDisplay = document.getElementById('totalAmount');
        const amountInput = document.getElementById('amount');

        // Add number to words conversion function
        function numberToWords(num) {
            const single = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine'];
            const double = ['Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];
            const tens = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];
            const formatTens = (num) => {
                if (num < 10) return single[num];
                if (num < 20) return double[num - 10];
                return tens[Math.floor(num / 10)] + (num % 10 ? ' ' + single[num % 10] : '');
            };
            
            if (num === 0) return 'Zero';
            
            const formatHundreds = (num) => {
                if (num < 100) return formatTens(num);
                return single[Math.floor(num / 100)] + ' Hundred' + (num % 100 ? ' ' + formatTens(num % 100) : '');
            };
            
            const formatGroup = (num) => {
                if (num === 0) return '';
                return formatHundreds(num);
            };
            
            let result = '';
            if (num >= 10000000) {
                result += formatGroup(Math.floor(num / 10000000)) + ' Crore ';
                num %= 10000000;
            }
            if (num >= 100000) {
                result += formatGroup(Math.floor(num / 100000)) + ' Lakh ';
                num %= 100000;
            }
            if (num >= 1000) {
                result += formatGroup(Math.floor(num / 1000)) + ' Thousand ';
                num %= 1000;
            }
            result += formatGroup(num);
            
            return result.trim();
        }

        // Update the total amount display and words when denomination values change
        function updateTotalAmount() {
            let total = 0;
            denominationInputs.forEach(input => {
                const value = parseInt(input.value) || 0;
                const denomination = parseInt(input.id.substring(1));
                total += value * denomination;
            });
            totalAmountDisplay.textContent = `₹${total.toLocaleString('en-IN')}`;
            amountInput.value = total;
            
            // Add total in words display
            const totalInWords = document.getElementById('totalInWords');
            if (total > 0) {
                totalInWords.textContent = `Rupees ${numberToWords(total)} Only`;
            } else {
                totalInWords.textContent = '';
            }
        }

        denominationInputs.forEach(input => {
            input.addEventListener('input', updateTotalAmount);
        });

        // Update timestamp function
        function updateTimestamp() {
            const now = new Date();
            const options = { 
                weekday: 'short',
                year: 'numeric', 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit'
            };
            document.getElementById('timestamp').textContent = now.toLocaleString('en-US', options);
        }

        // Update timestamp every second
        updateTimestamp();
        setInterval(updateTimestamp, 1000);
    </script>

    <style>
        .denomination-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .total-amount {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }

        .amount-display {
            font-size: 24px;
            font-weight: bold;
            color: #28a745;
            margin-top: 10px;
        }

        .total-in-words {
            margin-top: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        .words-display {
            font-size: 14px;
            color: #495057;
            margin-top: 5px;
            font-style: italic;
        }

        .timestamp {
            color: #ffffff;
            font-size: 14px;
            margin-left: 20px;
            display: inline-block;
            padding: 5px 10px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }
    </style>
</body>
</html>